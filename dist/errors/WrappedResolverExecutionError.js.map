{"version":3,"file":"WrappedResolverExecutionError.js","names":["_neTagFns","require","_BaseError","_interopRequireDefault","_util","e","__esModule","default","isFn","o","test","Object","prototype","toString","call","WrappedResolverExecutionError","BaseError","constructor","error","resolver","index","args","context","results","fn","order","dropLowest","name","wasBigArrowFunction","inspect","colors","depth","valueOf","exports","_default"],"sources":["../../src/errors/WrappedResolverExecutionError.js"],"sourcesContent":["// @ts-check\n\nimport { inline, dropLowest } from 'ne-tag-fns'\nimport BaseError from './BaseError.js'\nimport { inspect } from 'util'\n\nconst isFn = (o) => /Function\\]/.test(Object.prototype.toString.call(o))\n\n/**\n * ExtendedResolvers wrap several functions including the original GraphQL\n * field resolver itself. If an exception is thrown by any of the internal\n * methods, this error can help resolve those problems.\n *\n * @class WrappedResolverExecutionError\n */\nexport class WrappedResolverExecutionError extends BaseError {\n  /**\n   * The `ExtendedResolver` object that caused the issue\n   *\n   * @type {ExtendedResolver}\n   */\n  resolver: ExtendedResolver\n\n  /**\n   * The index of the function that failed. This will help the programmer\n   * determine the function that caused the error.\n   *\n   * @type {number}\n   */\n  index;\n\n  /**\n   * The arguments passed to the function in question that failed.\n   *\n   * @type {unknown[]}\n   */\n  args;\n\n  /**\n   * The `this` value passed to the function as it was executed. Note that\n   * this value is irrelevant if the function passed was a big arrow function\n   *\n   * @type {unknown}\n   */\n  context;\n\n  /**\n   * The `results` value before the internal resolver that failed was thrown.\n   * This does not include the results of the erroring function in question as\n   * no value was ever reached before the exception was thrown (in theory)\n   *\n   * @type {unknown}\n   */\n  results\n\n  /**\n   * Creates a new error instance of `WrappedResolverExecutionError`. The\n   * arguments resolver, index, args and context all help the programmer\n   * debug the issue in question should the error be thrown.\n   *\n   * @method constructor\n   *\n   * @param {Error|string} error the error thrown at the time of the problem\n   * @param {ExtendedResolver} resolver the `ExtendedResolver` instance\n   * @param {number} index the index of the wrapped resolver that threw up\n   * @param {unknown[]} args the arguments passed to the function at the time\n   * @param {unknown} context the `thisArg` set on the function call at the time\n   * @param {unknown} results the results up to the time of failure\n   */\n  constructor(error, resolver, index, args, context, results) {\n    super(error)\n\n    this.resolver = resolver\n    this.index = index\n    this.args = args\n    this.context = context\n    this.results = results\n  }\n\n  /**\n   * Description of the WrappedResolverExecutionError error and likely cause\n   * and fix.\n   *\n   * @return {string} a string denoting the purpose/cause of this error class\n   */\n  toString() {\n    let fn: Function = (\n      this.resolver &&\n      this.resolver.order &&\n      this.resolver.order[this.index]\n    )\n\n    return dropLowest`\n      The ExtendedResolver execution failed. The resolver that failed was at\n      index ${this.index}. The function had a name of '${fn && fn.name}'.\n\n      Was the function likely a big arrow function? ${\n        (this.wasBigArrowFunction\n          ? '\\x1b[33mtrue\\x1b[0m'\n          : '\\x1b[31mfalse\\x1b[0m'\n        )\n      }\n\n      Arguments at the time were:\n      ${inspect(this.args, {colors: true, depth: 8})}\n\n      Context at the time was:\n      ${inspect(this.context, {colors: true, depth: 8})}\n\n      Results before the function was called\n      ${inspect(this.results, {colors: true, depth: 8})}\n\n      Original Stack Trace\n      ${this.error.toString()}\n    `\n  }\n\n  /**\n   * Modify the `valueOf()` function to mirror the `toString()` functionality\n   *\n   * @return {string} an identical string to `.toString()`\n   */\n  valueOf() {\n    return this.toString()\n  }\n\n  /**\n   * A programmatic attempt to determine if the function that failed was a\n   * big arrow function. This means the function was pre-bound and the\n   * `context` set at the time of execution would have been ignored.\n   *\n   * @type {boolean}\n   */\n  get wasBigArrowFunction() {\n    const resolver = (\n      this.resolver &&\n      this.resolver.order &&\n      this.resolver.order[this.index]\n    )\n\n    if (resolver && isFn(resolver)) {\n      return typeof resolver.prototype === 'undefined'\n    }\n\n    return false\n  }\n}\n\nexport default WrappedResolverExecutionError\n"],"mappings":";;;;;;AAEA,IAAAA,SAAA,GAAAC,OAAA;AACA,IAAAC,UAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,KAAA,GAAAH,OAAA;AAA8B,SAAAE,uBAAAE,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAJ9B;;AAMA,MAAMG,IAAI,GAAIC,CAAC,IAAK,YAAY,CAACC,IAAI,CAACC,MAAM,CAACC,SAAS,CAACC,QAAQ,CAACC,IAAI,CAACL,CAAC,CAAC,CAAC;;AAExE;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMM,6BAA6B,SAASC,kBAAS,CAAC;EAC3D;AACF;AACA;AACA;AACA;;EAGE;AACF;AACA;AACA;AACA;AACA;;EAGE;AACF;AACA;AACA;AACA;;EAGE;AACF;AACA;AACA;AACA;AACA;;EAGE;AACF;AACA;AACA;AACA;AACA;AACA;;EAGE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,WAAWA,CAACC,KAAK,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,IAAI,EAAEC,OAAO,EAAEC,OAAO,EAAE;IAC1D,KAAK,CAACL,KAAK,CAAC;IAEZ,IAAI,CAACC,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAACC,KAAK,GAAGA,KAAK;IAClB,IAAI,CAACC,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACC,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,OAAO,GAAGA,OAAO;EACxB;;EAEA;AACF;AACA;AACA;AACA;AACA;EACEV,QAAQA,CAAA,EAAG;IACT,IAAIW,EAAY,GACd,IAAI,CAACL,QAAQ,IACb,IAAI,CAACA,QAAQ,CAACM,KAAK,IACnB,IAAI,CAACN,QAAQ,CAACM,KAAK,CAAC,IAAI,CAACL,KAAK,CAC/B;IAED,OAAO,IAAAM,oBAAU;AACrB;AACA,cAAc,IAAI,CAACN,KAAK,iCAAiCI,EAAE,IAAIA,EAAE,CAACG,IAAI;AACtE;AACA,sDACS,IAAI,CAACC,mBAAmB,GACrB,qBAAqB,GACrB,sBAAsB;AAClC;AACA;AACA,QAEQ,IAAAC,aAAO,EAAC,IAAI,CAACR,IAAI,EAAE;MAACS,MAAM,EAAE,IAAI;MAAEC,KAAK,EAAE;IAAC,CAAC,CAAC;AACpD;AACA;AACA,QAAQ,IAAAF,aAAO,EAAC,IAAI,CAACP,OAAO,EAAE;MAACQ,MAAM,EAAE,IAAI;MAAEC,KAAK,EAAE;IAAC,CAAC,CAAC;AACvD;AACA;AACA,QAAQ,IAAAF,aAAO,EAAC,IAAI,CAACN,OAAO,EAAE;MAACO,MAAM,EAAE,IAAI;MAAEC,KAAK,EAAE;IAAC,CAAC,CAAC;AACvD;AACA;AACA,QAAQ,IAAI,CAACb,KAAK,CAACL,QAAQ,CAAC,CAAC;AAC7B,KAAK;EACH;;EAEA;AACF;AACA;AACA;AACA;EACEmB,OAAOA,CAAA,EAAG;IACR,OAAO,IAAI,CAACnB,QAAQ,CAAC,CAAC;EACxB;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACE,IAAIe,mBAAmBA,CAAA,EAAG;IACxB,MAAMT,QAAQ,GACZ,IAAI,CAACA,QAAQ,IACb,IAAI,CAACA,QAAQ,CAACM,KAAK,IACnB,IAAI,CAACN,QAAQ,CAACM,KAAK,CAAC,IAAI,CAACL,KAAK,CAC/B;IAED,IAAID,QAAQ,IAAIX,IAAI,CAACW,QAAQ,CAAC,EAAE;MAC9B,OAAO,OAAOA,QAAQ,CAACP,SAAS,KAAK,WAAW;IAClD;IAEA,OAAO,KAAK;EACd;AACF;AAACqB,OAAA,CAAAlB,6BAAA,GAAAA,6BAAA;AAAA,IAAAmB,QAAA,GAAAD,OAAA,CAAA1B,OAAA,GAEcQ,6BAA6B","ignoreList":[]}